
= form_with(model: [:manage, page], local: true, class: "h-100") do |form|
  - if page.errors.any?
    .alert.alert-danger.mb-4
      %h5.alert-heading
        %i.bi.bi-exclamation-triangle.me-2
        = pluralize(page.errors.count, "error")
        prohibited this page from being saved:
      %ul.mb-0
        - page.errors.each do |error|
          %li= error.full_message

  .row.h-100
    / Main content area
    .col-lg-8.h-100
      .card.h-100.border-0.shadow-sm
        .card-body.p-4.d-flex.flex-column
          / Title field
          .mb-4
            = form.label :title, class: "form-label h5 text-dark mb-3"
            = form.text_field :title, class: "form-control form-control-lg border-0 bg-light", placeholder: "Enter your page title..."
          
          / Content editor
          .flex-grow-1.d-flex.flex-column
            = form.label :content, "Content", class: "form-label h6 text-muted mb-3"
            .flex-grow-1
              = form.rich_text_area(:content, class: "form-control border-0", style: "min-height: 400px;") do
                %lexxy-prompt{trigger: '#', src: manage_links_path, "remote-filtering": true, "insert-editable-text": true, "supports-space-in-searches": true}

    / Sidebar
    .col-lg-4.h-100
      .sticky-lg-top{style: "top: 2rem;"}
        / Publish settings card
        .card.border-0.shadow-sm.mb-4{"data-controller" => "publish"}
          .card-header.bg-white.border-0.pb-0
            %h6.card-title.text-dark.mb-0
              %i.bi.bi-send.me-2
              Publish Settings
          .card-body.pt-3
            / Publish checkbox
            .form-check.form-switch.mb-4
              = form.check_box :publish, class: "form-check-input", role: "switch", id: "publishSwitch", "data-publish-target": "checkbox", "data-action": "change->publish#toggle"
              = form.label :publish, "Ready to publish", class: "form-check-label", for: "publishSwitch"
            
            / Publish date (conditional)
            %div{"data-publish-target": "dateField", style: page.publish ? "" : "display: none;"}
              = form.label :published_at, "Publish date & time", class: "form-label small text-muted mb-2"
              = form.datetime_local_field :published_at, value: page.published_at&.strftime("%Y-%m-%dT%H:%M"), class: "form-control", "data-publish-target": "dateInput"
              .form-text.text-muted.small
                Leave empty to publish immediately

        / Excerpt card
        .card.border-0.shadow-sm.mb-4
          .card-header.bg-white.border-0.pb-0
            %h6.card-title.text-dark.mb-0
              %i.bi.bi-card-text.me-2
              Excerpt
          .card-body.pt-3
            = form.label :excerpt, "Custom excerpt", class: "form-label small text-muted mb-2"
            = form.text_area :excerpt, rows: 4, class: "form-control", placeholder: "Enter a custom excerpt..."
            .form-text.text-muted.small
              If left blank, the first paragraph of your content will be used automatically.

        / Cover Image card
        .card.border-0.shadow-sm.mb-4
          .card-header.bg-white.border-0.pb-0
            %h6.card-title.text-dark.mb-0
              %i.bi.bi-image.me-2
              Cover Image
          .card-body.pt-3
            - if page.has_cover_image? && page.cover_image_thumbnail
              .mb-3
                = image_tag page.cover_image_thumbnail, class: "img-fluid rounded", alt: "Cover image preview"
                .mt-2
                  = form.label :cover_image, "Replace cover image", class: "form-label small text-muted mb-2"
            - else
              = form.label :cover_image, "Upload cover image", class: "form-label small text-muted mb-2"
            
            = form.file_field :cover_image, accept: "image/jpeg,image/png,image/webp", class: "form-control mb-3"
            
            = form.label :cover_image_attribution, "Attribution (optional)", class: "form-label small text-muted mb-2"
            = form.text_area :cover_image_attribution, rows: 2, class: "form-control", placeholder: "Photo credit or attribution text..."
            
            .form-text.text-muted.small
              Supported formats: JPEG, PNG, WebP. Maximum size: 10MB.
              
            - if page.has_cover_image?
              .mt-3
                = form.check_box :remove_cover_image, {}, "1", ""
                = form.label :remove_cover_image, "Remove current cover image", class: "form-check-label small"

        / URL Settings card
        .card.border-0.shadow-sm.mb-4
          .card-header.bg-white.border-0.pb-0
            %h6.card-title.text-dark.mb-0
              %i.bi.bi-link-45deg.me-2
              URL Settings
          .card-body.pt-3
            / Slug field
            = form.label :slug, "URL Slug", class: "form-label small text-muted mb-2"
            = form.text_field :slug, class: "form-control", placeholder: "url-slug"
            .form-text.text-muted.small
              This will be auto-generated from the title if left blank. Used for the URL: 
              %code= "/pages/#{page.slug || 'your-slug'}"

        / Action buttons card
        .card.border-0.shadow-sm
          .card-body.p-3
            .d-grid.gap-2
              = form.submit page.persisted? ? "Update Page" : "Create Page", class: "btn btn-primary btn-lg"
              - if page.persisted?
                = link_to "Cancel", manage_page_path(page), class: "btn btn-outline-secondary"
              - else
                = link_to "Cancel", manage_pages_path, class: "btn btn-outline-secondary"
